var S=Object.defineProperty;var C=(o,t,e)=>t in o?S(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var a=(o,t,e)=>C(o,typeof t!="symbol"?t+"":t,e);import{d as A}from"./vue-ecosystem-D9FQmOGZ.js";import{J as W,w as y,c}from"./vue-chunks-DYiGSM6T.js";class r{constructor(t){a(this,"getCollections",()=>this.collections||null);this.likes=new Set(t?.likes||[]),this.collections=new Set(t?.collections||[]),this.watchRecords=new Map((t?.watchRecords||[]).map(e=>[e.id,{lastEpisode:e.lastEpisode,timestamp:e.timestamp,episodes:new Set(e.episodes)}]))}toggleLike(t){this.likes.has(t)?this.likes.delete(t):this.likes.add(t)}toggleCollection(t){this.collections.has(t)?this.collections.delete(t):this.collections.add(t)}updateWatchRecord(t,e){if(!this.watchRecords.has(t))this.watchRecords.set(t,{lastEpisode:e,timestamp:Date.now(),episodes:new Set([e])});else{const l=this.watchRecords.get(t);l.lastEpisode=e,l.timestamp=Date.now(),l.episodes.add(e)}}getLikesCount(){return this.likes.size}getCollectionsCount(){return this.collections.size}getWatchRecordsCount(){return this.watchRecords.size}getWatchRecord(t){return this.watchRecords.get(t)||null}getWatchRecordAll(){return this.watchRecords||null}getLikes(){return this.likes||null}toJSON(){return{likes:Array.from(this.likes),collections:Array.from(this.collections),watchRecords:Array.from(this.watchRecords.entries()).map(([t,e])=>({id:t,lastEpisode:e.lastEpisode,timestamp:e.timestamp,episodes:Array.from(e.episodes)}))}}clearAll(){this.likes.clear(),this.collections.clear(),this.watchRecords.clear()}static fromJSON(t){return new r(t)}}const E=A("drama",()=>{const o=localStorage.getItem("dramaStore"),t=W(o?r.fromJSON(JSON.parse(o)):new r);y(()=>t.toJSON(),s=>{localStorage.setItem("dramaStore",JSON.stringify(s))},{deep:!0});function e(s){s&&t.toggleLike(s)}function l(s){s&&t.toggleCollection(s)}function n(s,i){s&&i&&t.updateWatchRecord(s,i)}function h(){t.clearAll(),localStorage.removeItem("dramaStore")}const d=s=>c(()=>t.likes.has(s)),m=s=>c(()=>t.collections.has(s)),g=s=>c(()=>t.getWatchRecord(s)),u=()=>Array.from(t.getWatchRecordAll()),p=()=>Array.from(t.getLikes()),w=()=>Array.from(t.getCollections()),R=c(()=>t.likes.size),f=c(()=>t.collections.size),k=c(()=>t.watchRecords.size);return{manager:t,toggleLike:e,toggleCollection:l,updateWatchRecord:n,isLiked:d,isCollected:m,getWatchRecord:g,clearAllData:h,getLikes:p,getCollections:w,likesCount:R,collectionsCount:f,watchRecordsCount:k,getWatchRecordAll:u}});export{E as u};
