import{J as f,L as S,z as C,m as o}from"./index--Yzb7obU.js";class l{constructor(t){this.likes=new Set(t?.likes||[]),this.collections=new Set(t?.collections||[]),this.watchRecords=new Map((t?.watchRecords||[]).map(s=>[s.id,{lastEpisode:s.lastEpisode,timestamp:s.timestamp,episodes:new Set(s.episodes)}]))}toggleLike(t){this.likes.has(t)?this.likes.delete(t):this.likes.add(t)}toggleCollection(t){this.collections.has(t)?this.collections.delete(t):this.collections.add(t)}updateWatchRecord(t,s){if(!this.watchRecords.has(t))this.watchRecords.set(t,{lastEpisode:s,timestamp:Date.now(),episodes:new Set([s])});else{const c=this.watchRecords.get(t);c.lastEpisode=s,c.timestamp=Date.now(),c.episodes.add(s)}}getLikesCount(){return this.likes.size}getCollectionsCount(){return this.collections.size}getWatchRecordsCount(){return this.watchRecords.size}getWatchRecord(t){return this.watchRecords.get(t)||null}getWatchRecordAll(){return this.watchRecords||null}getLikes(){return this.likes||null}getCollections=()=>this.collections||null;toJSON(){return{likes:Array.from(this.likes),collections:Array.from(this.collections),watchRecords:Array.from(this.watchRecords.entries()).map(([t,s])=>({id:t,lastEpisode:s.lastEpisode,timestamp:s.timestamp,episodes:Array.from(s.episodes)}))}}clearAll(){this.likes.clear(),this.collections.clear(),this.watchRecords.clear()}static fromJSON(t){return new l(t)}}const W=f("drama",()=>{const r=localStorage.getItem("dramaStore"),t=S(r?l.fromJSON(JSON.parse(r)):new l);C(()=>t.toJSON(),e=>{localStorage.setItem("dramaStore",JSON.stringify(e))},{deep:!0});function s(e){e&&t.toggleLike(e)}function c(e){e&&t.toggleCollection(e)}function a(e,i){e&&i&&t.updateWatchRecord(e,i)}function n(){t.clearAll(),localStorage.removeItem("dramaStore")}const h=e=>o(()=>t.likes.has(e)),d=e=>o(()=>t.collections.has(e)),m=e=>o(()=>t.getWatchRecord(e)),g=()=>Array.from(t.getWatchRecordAll()),u=()=>Array.from(t.getLikes()),p=()=>Array.from(t.getCollections()),w=o(()=>t.likes.size),R=o(()=>t.collections.size),k=o(()=>t.watchRecords.size);return{manager:t,toggleLike:s,toggleCollection:c,updateWatchRecord:a,isLiked:h,isCollected:d,getWatchRecord:m,clearAllData:n,getLikes:u,getCollections:p,likesCount:w,collectionsCount:R,watchRecordsCount:k,getWatchRecordAll:g}});export{W as u};
